import{n as f,a as v,c as C,k as h}from"./index-BR-PFC2m.js";import{B as _}from"./BaseCardGallery-D4R06ceq.js";import{b}from"./BaseFilterDialog-b2RE-qND.js";import{B as g}from"./BaseFilterDescription-BffbdYBC.js";import{H as d,D as M,A as y,S as D}from"./stock-CLNdE23Z.js";import"./Car-CQ6DFsNz.js";import"./Row-DOgu6NRG.js";import"./BaseCard-CTEQO1B5.js";import"./BaseDualSlider-4dZ1Waol.js";import"./BaseExpandDiv-1VZq3Ohy.js";let u=0;const $={name:"HighchartsGeneric",components:{},props:{config:{type:Object,default(){return{}}},counter:{type:Number,default:0},trackCode:{type:String,default:""}},data(){return u+=1,{id:`hcgid-${u}`,chart:null,returnedFunction:null,noData:!1}},watch:{counter(){let s=this;console.log(this.counter),setTimeout(()=>{s.handleResize()},0)},config(){this.checkEmpty()}},beforeMount(){M(d),y(d),D(d),this.returnedFunction=Vue.debounce(this.handleResize,200),window.addEventListener("resize",this.returnedFunction)},mounted(){this.checkEmpty()},beforeDestroy(){window.removeEventListener("resize",this.returnedFunction)},computed:{},methods:{renderChart(){var s=this;let e={chart:{type:"spline",zoomType:"x",pinchType:"xy",reflow:!1,events:{load:function(t){t.target.reflow()}},animation:{duration:200},resetZoomButton:{position:{y:30}}},title:{text:""},subtitle:{text:""},credits:{enabled:!1},tooltip:{style:{fontSize:"14px"},useHTML:!0,formatter:s.config.disableTooltipFormater?void 0:function(){if(this.point.className==="HighchartsGeneric_HidePoint"||!this.point.custom||!this.point.custom.photo)return!1;var t=`<img src="${this.point.custom.photo}" class="HighchartsGeneric_CarPhoto"><div><span style="color: ${this.point.custom.color}">RQ${this.point.y}</span>&nbsp;<span>${this.point.name}</span></div><span><b>${s.$t("m_time")}: </b>${Vue.options.filters.toTimeString(this.point.x,s.trackCode)}</span><br/><span><b>${s.$tc("c_tyre",2)}: </b>${this.point.custom.car.tyres}</span><br/><span><b>${s.$tc("c_drive",2)}: </b>${this.point.custom.car.drive}</span><br/><span><b>${s.$tc("c_clearance",2)}: </b>${this.point.custom.car.clearance}</span><br/><span><b>MRA: </b>${this.point.custom.car.mra}</span><br/><span><b>${s.$t("m_by")}: </b>${this.point.custom.user}</span><br/>`;return t}},xAxis:{title:{enabled:!1},tickLength:0,gridLineColor:"#fff1",gridLineWidth:"1",labels:{style:{fontSize:"14px"}}},yAxis:{allowDecimals:!1,title:{enabled:!1},gridLineColor:"#fff1",tickLength:0,labels:{style:{fontSize:"14px"}}},legend:{enabled:!0,itemStyle:{fontSize:"14px"}},plotOptions:{scatter:{centerInCategory:!0,states:{hover:{marker:{enabled:!1}}},marker:{radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},events:{click:function(t){s.$emit("detail",t)}}}},series:[]};e=window._merge(e,this.config),d.setOptions({lang:{thousandsSep:".",decimalPoint:",",numericSymbols:[null,"mi","bi","tri","qua","quin"]}}),this.chart?this.chart.update({series:e.series,xAxis:e.xAxis},!0,!0,!0):this.chart=d.chart(this.id,e)},checkEmpty(){let s=!0;this.config.series&&this.config.series.map(e=>{e.data&&e.data.length>0&&(s=!1)}),s?this.noData=!0:(this.noData=!1,this.$nextTick().then(()=>{this.renderChart()}))},handleResize(){this.chart&&(this.chart.destroy(),this.chart=null,this.renderChart())}}};var k=function(){var e=this,t=e._self._c;return t("div",{staticClass:"HighchartsGeneric_Layout"},[e.noData?t("div",{staticClass:"HighchartsGeneric_Empty"},[e.config.title?t("div",{staticClass:"HighchartsGeneric_TitleEmpty"},[e._v(e._s(e.config.title.text))]):e._e(),e._v(" "+e._s(e.$t("m_noData"))+" ")]):e._e(),t("div",{staticClass:"HighchartsGeneric_Div",attrs:{id:e.id}})])},T=[],R=f($,k,T,!1,null,null);const N=R.exports,S={name:"MainCsvChart",components:{BaseCardGallery:_,BaseFilterDialog:b,BaseFilterDescription:g,BaseIconSvg:C,HighchartsGeneric:N,BaseChip:v},props:{test:{type:Boolean,default:!1}},data(){return{items:[],all_cars:h,all_cars_obj:{},resolvedRids:{},guidToRid:{},carsReady:!1,memoryFileName:"Rallycross medium_30Dirt&70Mud.csv",chartHideOutOfFilter:!1,tyres:["Off-road","All-surface","Standard","Performance","Slick"],drives:["FWD","RWD","4WD"],clearances:["Low","Mid","High"],tyresModel:[],drivesModel:[],clearancesModel:[],hoverClass:"",cats:["2WD_Off-road","2WD_All-surface","2WD_Standard","2WD_Performance","Slick","4WD_Off-road","4WD_All-surface","4WD_Standard","4WD_Performance"]}},watch:{},beforeMount(){this.tyresModel=this.tyres,this.drivesModel=this.drives,this.clearancesModel=this.clearances,Number.prototype.toHHMMSS=function(){var s=Number(this.toFixed(3).slice(0,-1)),e=parseInt(s,10),t=Math.floor(e/3600),o=Math.floor((e-t*3600)/60),r=e-t*3600-o*60,i=Math.round((s-parseInt(s))*100);return t<10&&(t="0"+t),o<10&&(o="0"+o),r<10&&(r="0"+r),i<10&&(i="0"+i),o+":"+r+":"+i},String.prototype.toTime=function(){return Vue.options.filters.toTimeNumber(this,"")},Number.prototype.toTestBowl=function(){return parseInt(this*2.2369)}},mounted(){this.carsReady||this.transformAllCarsToObj(),typeof temp<"u"&&this.pushNewItem(temp)},computed:{},methods:{pushNewItem(s){s[0].Time&&s.map(t=>{if(t.time=Number(t.Time),t.timeParsed=t.time.toHHMMSS(),t.rid=this.guidToRid[t["Car GUID"]],t.rq=Number(t.RQ),t.class=Vue.resolveClass(t.rq,null,"letter"),!t.rid)debugger;this.addToResolvedRids(t.rid),t.car=this.all_cars_obj[t.rid];let o="";t.car.tyres==="Slick"?o="Slick":(t.car.drive==="4WD"?o="4WD":o="2WD",o+=`_${t.car.tyres}`),t.cat=o});let e={json:s,title:this.memoryFileName,filter:{},charts:[this.chart_scatter(s),this.chart_line(s)]};this.items.push(e)},loadCSV(s,e=null){if(!e&&(!s.target.files||s.target.files.length===0))return;e||(e=s.target.files[0]),this.memoryFileName=e.name;let t=new FileReader;t.onload=this.onload,t.readAsText(e)},onload(s){let e=s.target.result,t=this.csvJSON(e);this.pushNewItem(t)},csvJSON(s){var e=s.split(`
`),t=[],o=e[0].split(",");let r=["09d252e4-0027-403a-98ac-8d9c221553ba","40c22d49-b033-4e08-931b-1cdf974b8a42","951ddd6a-dbec-4332-b870-abade85f2654","17266626-c38c-4b1d-8bb9-630df210349c","7e3cd48b-109b-4d48-a163-959a732657de","4a71feed-db9e-420d-96f1-6d174a1f32cd","d91a3551-0098-4b63-805a-35ede20ade3c","25db2bc3-dcbe-41a6-8466-38a52d1485d6","00c58c19-0efa-4158-b45b-77a16ca9647f","238d59c6-71fc-469a-8add-487754de7e74"];for(var i=1;i<e.length;i++){for(var a={},n=e[i].split(","),l=0;l<o.length;l++)a[(o[l]||"").trim()]=(n[l]||"").trim();a["Car GUID"]&&(r.includes(a["Car GUID"])||t.push(a))}return t},addToResolvedRids(s){if(!this.resolvedRids[s]){let e=this.all_cars_obj[s];e&&(e.color=Vue.resolveClass(e.rq,e.class,"color"),e.colorRgb=Vue.resolveClass(e.rq,e.class,"color",!0),e.photo=Vue.carPhoto(e),this.resolvedRids[s]=e)}},transformAllCarsToObj(){let s="rid";h.map(e=>{this.all_cars_obj[e[s]]=e,this.guidToRid[e.guid]=e.rid}),this.carsReady=!0},resolveTuneZ(s){return`${(s.engineMajor-1)*3+s.engineMinor}${(s.weightMajor-1)*3+s.weightMinor}${(s.chassisMajor-1)*3+s.chassisMinor}`},resolveTune(s){let e=null;return s[0]%3===0&&s[1]%3===0&&s[2]%3===0&&(e=`${s[0]/3}${s[1]/3}${s[2]/3}`),e},detailClick(s){console.log(JSON.parse(JSON.stringify(s.point.custom)))},chart_scatter(s){let e=[];s.map((r,i)=>{if(this.chartHideOutOfFilter||r.Result!=="Finished")return;let a=e.find(n=>n.name===r.class);a||(e.push({name:r.class,color:Vue.resolveClass(r.rq,r.class,"color")}),a=e[e.length-1]),a.data||(a.data=[]),a.data.push({y:r.rq,x:r.time,name:`${r.Name}`,className:`MainCsvChart_C_DRIVE_${r.car.drive} MainCsvChart_C_TYRE_${r.car.tyres} MainCsvChart_C_CLEAR_${r.car.clearance}`,custom:{...r,photo:this.resolvedRids[r.rid].photo,color:this.resolvedRids[r.rid].color}})});var t="ontouchstart"in window||navigator.msMaxTouchPoints;return{config:{boost:{seriesThreshold:e.length,useGPUTranslations:!0,usePreAllocated:!0},chart:{type:"scatter",height:600},legend:{enabled:!1},series:e,yAxis:{min:10,max:120,allowDecimals:!1,labels:{format:"RQ{text}"}},xAxis:{type:"logarithmic",allowDecimals:!1,labels:{format:"{text}s"}},tooltip:{snap:t?50:10},plotOptions:{series:{stickyTracking:!!t,turboThreshold:2e3},scatter:{boostThreshold:2e3}}},counter:0}},chart_line(s){let e=[],t={},o={};this.cats.map(a=>{t[a]={},o[a]={},e.push({name:a,data:[]})}),s.map((a,n)=>{a.Result==="Finished"&&(t[a.cat][a.rq]||(t[a.cat][a.rq]=[]),t[a.cat][a.rq].push(a.time))}),Object.keys(t).map(a=>{Object.keys(t[a]).map(n=>{let c=t[a][n].reduce((m,p)=>m+p,0)/t[a][n].length;if(isNaN(c)||c<0)debugger;o[a][n]=c})}),e.map(a=>{Object.keys(o[a.name]).map(n=>{a.data.push({y:Number(n),x:Number(o[a.name][n].toFixed(2))}),a.data.sort((l,c)=>l.y-c.y)}),a.dataLabels={enabled:!0,formatter:function(){return this.point.index===this.series.data.length-1?this.series.name:""},style:{fontWeight:"bold",color:"black"}}});var r="ontouchstart"in window||navigator.msMaxTouchPoints;return{config:{disableTooltipFormater:!1,title:{text:"Avg time per RQ and cat"},boost:{seriesThreshold:e.length,useGPUTranslations:!0,usePreAllocated:!0},chart:{type:"spline",height:600},colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],legend:{enabled:!0},series:e,yAxis:{min:10,max:120,allowDecimals:!1,labels:{format:"RQ{text}"}},xAxis:{type:"logarithmic",allowDecimals:!1,labels:{format:"{text}s"}},tooltip:{snap:r?50:10},plotOptions:{series:{stickyTracking:!!r,turboThreshold:2e3}}},counter:0}}}};var w=function(){var e=this,t=e._self._c;return t("div",{staticClass:"MainCsvChart_Layout"},[e._l(e.items,function(o,r){return t("div",{staticClass:"MainCsvChart_W"},[t("div",{staticClass:"MainCsvChart_Header"},[t("div",{staticClass:"MainCsvChart_"}),t("div",{staticClass:"MainCsvChart_ItemTitle"},[e._v(e._s(o.title))]),t("div",{staticClass:"MainCsvChart_HeaderDelete"},[t("button",{staticClass:"D_Button D_ButtonDarkTransparent",on:{click:function(i){e.items=e.items.filter((a,n)=>n!==r)}}},[t("i",{staticClass:"ticon-close_3",attrs:{"aria-hidden":"true"}})])])]),t("div",{staticClass:"MainCsvChart_Body",class:{MainCsvChart_Not_FWD:!e.drivesModel.includes("FWD")||e.hoverClass==="FWD",MainCsvChart_Not_RWD:!e.drivesModel.includes("RWD")||e.hoverClass==="RWD",MainCsvChart_Not_4WD:!e.drivesModel.includes("4WD")||e.hoverClass==="4WD",MainCsvChart_Not_Low:!e.clearancesModel.includes("Low")||e.hoverClass==="Low",MainCsvChart_Not_Mid:!e.clearancesModel.includes("Mid")||e.hoverClass==="Mid",MainCsvChart_Not_High:!e.clearancesModel.includes("High")||e.hoverClass==="High",MainCsvChart_Not_Performance:!e.tyresModel.includes("Performance")||e.hoverClass==="Performance",MainCsvChart_Not_Standard:!e.tyresModel.includes("Standard")||e.hoverClass==="Standard","MainCsvChart_Not_All-surface":!e.tyresModel.includes("All-surface")||e.hoverClass==="All-surface","MainCsvChart_Not_Off-road":!e.tyresModel.includes("Off-road")||e.hoverClass==="Off-road",MainCsvChart_Not_Slick:!e.tyresModel.includes("Slick")||e.hoverClass==="Slick"}},[t("div",{staticClass:"MainCsvChart_Chips"},[t("div",{staticClass:"Main_FilterThree",staticStyle:{margin:"15px 0px"}},[t("div",{staticClass:"Main_FilterChipsInside"},[e._l(e.tyres,function(i,a){return[t("div",{on:{mouseover:function(n){e.hoverClass=i},mouseout:function(n){e.hoverClass=""}}},[t("BaseChip",{staticClass:"BaseChip_MinWidth",attrs:{label:e.$t(`c_${i.toLowerCase()}2`),value:i},model:{value:e.tyresModel,callback:function(n){e.tyresModel=n},expression:"tyresModel"}})],1)]})],2),t("div",{staticClass:"Main_FilterChipsInside"},[e._l(e.drives,function(i,a){return[t("div",{on:{mouseover:function(n){e.hoverClass=i},mouseout:function(n){e.hoverClass=""}}},[t("BaseChip",{staticClass:"BaseChip_MinWidth",attrs:{value:i},model:{value:e.drivesModel,callback:function(n){e.drivesModel=n},expression:"drivesModel"}})],1)]})],2),t("div",{staticClass:"Main_FilterChipsInside"},[e._l(e.clearances,function(i,a){return[t("div",{on:{mouseover:function(n){e.hoverClass=i},mouseout:function(n){e.hoverClass=""}}},[t("BaseChip",{staticClass:"BaseChip_MinWidth",attrs:{label:e.$t(`c_${i.toLowerCase()}`),value:i},model:{value:e.clearancesModel,callback:function(n){e.clearancesModel=n},expression:"clearancesModel"}})],1)]})],2)])]),e._l(o.charts,function(i){return t("div",{staticClass:"MainCsvChart_Chart"},[i.config?t("div",{staticClass:"MainCharts_Body"},[t("HighchartsGeneric",{attrs:{config:i.config,counter:i.counter,trackCode:i.trackCode||""},on:{detail:function(a){return e.detailClick(a)}}})],1):e._e()])})],2)])}),t("div",{staticClass:"MainCsvChart_Footer D_Center2"},[t("div",{staticClass:"MainCsvChart_UploadButton"},[t("label",{staticClass:"D_Button D_ButtonDark D_ButtonDark2 MainCsvChart_UploadButton"},[t("input",{staticClass:"MainCsvChart_UploadInput",attrs:{type:"file",accept:"text/csv"},on:{change:function(o){return e.loadCSV(o)}}}),t("span",{staticClass:"MainCsvChart_UploadLabel"},[e._v("Load raw (CSV)")])])])])],2)},x=[],F=f(S,w,x,!1,null,null);const z=F.exports;export{z as default};
