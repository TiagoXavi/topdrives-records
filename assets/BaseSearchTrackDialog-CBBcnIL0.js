import{n as u,c as h,b as m,t as g}from"./index-BR-PFC2m.js";import{R as f,b as k}from"./Row-DOgu6NRG.js";import{c as _}from"./campaign-Dapxa4yk.js";const T={name:"BaseSearchTrackDialog",components:{BaseDialog:m,BaseTrackType:k,BaseIconSvg:h,Row:f},props:{active:{type:Boolean,default:!1},mode:{type:String,default:"other"}},data(){return{searchTracks:"",campaign:_,tracksRepo:g,cpTrackSuggestion:null}},watch:{active:function(){this.active&&(this.searchTracks="")}},beforeMount(){},mounted(){},computed:{filteredTracks(){let l=this,a=this.tracksRepo,e=["dry","wet","dirt","gravel","ice","sand","snow","grass"],i=this.searchTracks.toLowerCase().split(" "),r=i.filter(t=>e.includes(t)),n=i.filter(t=>!e.includes(t)),c=i[i.length-1];if(this.cpTrackSuggestion=null,i.length>1&&Number(c)>0&&Number(c)<11){let t=i[i.length-2],o=this.campaign.find((p,d)=>{if(d>13&&p.name.toLowerCase().includes(t))return!0});if(o){let p=[];o.matches[Number(c)-1].races.map(d=>{p.push({surface:d.name.slice(-2,-1),cond:d.name.slice(-1),code:d.name,id:d.name.slice(0,-4)})}),this.cpTrackSuggestion={name:`${o.name} ${c}`,list:p}}}if(r.length>0){let t=[],o=[];r.includes("dry")&&(t.push("0"),o.push("0")),r.includes("wet")&&o.push("1"),r.includes("dirt")&&(t.push("1"),t.push("4"),t.push("h")),r.includes("gravel")&&(t.push("2"),t.push("b")),r.includes("ice")&&(t.push("3"),t.push("g")),r.includes("sand")&&(t.push("5"),t.push("c")),r.includes("snow")&&(t.push("6"),t.push("d"),t.push("g"),t.push("h")),r.includes("grass")&&(t.push("7"),t.push("f")),a=a.filter(p=>p.types.find(d=>{if(t.length>0&&o.length>0)return t.includes(d[0])&&o.includes(d[1]);if(t.length>0)return t.includes(d[0]);if(o.length>0)return o.includes(d[1])}))}return n.length>0&&(a=a.filter(t=>l.$t("t_"+t.id).toLowerCase().includes(n.join(" ")))),a.map(t=>{t.nameCalc=this.$t("t_"+t.id),t.nameEng=this.$t("t_"+t.id,"en")}),a.sort((t,o)=>t.nameCalc.localeCompare(o.nameCalc)),a}},methods:{resolveTrack(l){let a=[];this.tracksRepo.find(i=>{if(l.slice(0,-4)!==i.id)return!1;i.types.find(r=>{if(l===`${i.id}_a${r}`)return a.push({name:i.name,id:i.id,surface:r[0],cond:r[1],code:`${i.id}_a${r}`}),!0})});let e=[],s=[];this.campaign.map((i,r)=>{i.matches.map((n,c)=>{n.races.map((t,o)=>{t.name===l&&s.push({city:i.name,icity:r,imatch:c,irace:o,code:`${r}${c}`})})})}),e.push(s),a.map((i,r)=>{let n;e[r].map(c=>{(!n||this.isChamp(n.city)&&!this.isChamp(c.city)||c.irace<n.irace&&!this.isChamp(c.city)||this.isChamp(n.city)&&this.isChamp(c.city)&&c.icity>n.icity||c.irace<=n.irace&&c.icity>n.icity||c.irace<=n.irace&&c.imatch>n.imatch)&&(n=c)}),n?(i.campaign=`${n.city} ${n.imatch+1}`,this.isChamp(n.city)||(i.campaignNum=n.irace+1)):i.campaign="Not in campaign"}),this.$emit("resolved",a[0])},clickhandle(l){if(l.target&&typeof l.target.className=="string"&&l.target.className.startsWith("BaseTrackType_Button")&&l.target.attributes.dataid){let a=l.target.attributes.getNamedItem("datatype").value,e=l.target.attributes.getNamedItem("dataid").value;this.$emit("toggleTrack",{track:`${e}_a${a}`,e:l}),this.resolveTrack(`${e}_a${a}`)}},isChamp(l){return l.startsWith("SN")||l.startsWith("YB")}}};var C=function(){var a=this,e=a._self._c;return e("BaseDialog",{attrs:{active:a.active,transparent:!1,isStatic:!0,forceScroll:!0,"max-width":"500px","min-width":"240px"},on:{close:function(s){return a.$emit("close")}}},[e("div",{staticClass:"Main_TracksDialog"},[e("div",{staticClass:"Main_AllTracksBox",on:{click:a.clickhandle}},[e("div",{staticClass:"Track_SearchBox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.searchTracks,expression:"searchTracks"}],staticClass:"D_SearchInput Track_SearchInput data-hj-allow",attrs:{id:"SearchTrackInput",placeholder:a.$t("m_searchTracks"),type:"search",autocomplete:"off"},domProps:{value:a.searchTracks},on:{input:function(s){s.target.composing||(a.searchTracks=s.target.value)}}}),a.searchTracks&&a.searchTracks.length>0?e("button",{staticClass:"D_Button Main_TrackSearchInputClose",on:{click:function(s){a.searchTracks=""}}},[e("i",{staticClass:"ticon-close_2",attrs:{"aria-hidden":"true"}})]):a._e()]),a._l(a.filteredTracks,function(s,i){return e("div",{key:i,staticClass:"Main_CustomTrackItem"},[e("div",{staticClass:"Main_CustomTrackLeft"},[e("div",{staticClass:"Main_CustomTrackName"},[[a._v(a._s(a._f("toTimeString")(s.nameCalc)))],s.nameEng.includes("(R)")?e("i",{staticClass:"tdicon-roll Row_TdIconPerk",attrs:{"aria-hidden":"true"}},[e("span",{staticClass:"path1"}),e("span",{staticClass:"path2"}),e("span",{staticClass:"path3"}),e("span",{staticClass:"path4"})]):a._e(),s.id==="csSmall"||s.id==="dockCity"||s.id==="csMed"||s.id==="oceanCity"||s.id==="speedbump12km"||s.id==="speedbump1km"||s.id==="desertHill"||s.id==="moto"||s.id==="desertRallyDirt"||s.id==="miStreets2"||s.id==="itBump"||s.id==="dsTnFreeway"||s.id==="dsTnLove"||s.id==="dsTnMile2bump"?e("i",{staticClass:"tdicon-clearance Row_TdIconPerk",attrs:{"aria-hidden":"true"}},[e("span",{staticClass:"path1"}),e("span",{staticClass:"path2"}),e("span",{staticClass:"path3"})]):a._e()],2)]),e("div",{staticClass:"Main_CustomTrackRight"},[[e("BaseTrackType",{attrs:{circuit:s,dataid:s.id,mode:a.mode}})]],2)])}),a.cpTrackSuggestion?e("div",{staticClass:"BaseSearchTrackDialog_CpSuggest"},[e("button",{staticClass:"BaseSearchTrackDialog_CpSuggestButton D_Button D_ButtonDark D_ButtonDark2 Main_SaveAllButton",on:{click:function(s){return a.$emit("pushCpSuggest",{list:a.cpTrackSuggestion.list,e:s})}}},[a._v(a._s(a.$t("m_load"))+" "+a._s(a.cpTrackSuggestion.name))]),e("div",{staticClass:"BaseSearchTrackDialog_RowList"},[e("Row",{staticStyle:{"pointer-events":"none"},attrs:{list:a.cpTrackSuggestion.list,showCampaignTip:!1}})],1)]):a._e()],2)])])},v=[],S=u(T,C,v,!1,null,null);const b=S.exports;export{b as B};
