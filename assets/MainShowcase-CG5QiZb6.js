import{a as n}from"./index-C8gjSc4W.js";import{n as r,y as l,a as d,k as c,d as u,b as h,r as _}from"./components-DpxtCXPw.js";const p={name:"MainShowcase",components:{BaseCard:_,BaseText:h,BaseDialog:u,BaseChip:c,BaseFilterDialog:d,BaseIconSvg:l},props:{test:{type:Boolean,default:!1}},data(){return{loading:!1,listLoading:!1,user:null,searchCarDialog:!1,all_cars:n,showcaseList:[],resolvedRids:{},carAddIndex:-1,showVideo:!0,cars:[],unsubscribe:null,uploadInput:null,downloadAnchor:null,confirmDelete:{dialog:!1,msg:"Confirm delete?",actionLabel:"Delete",action:null,loading:!1,classe:""},tempString:null,showMore:!1,saved:!1}},watch:{},beforeMount(){this.resetCars(),this.user=this.$store.state.user},mounted(){this.loadList();let a=this;a.unsubscribe=a.$store.subscribe(e=>{e.type=="CHANGE_USER"&&(a.user=e.payload.user,a.$route.name==="MainShowcase"&&a.load()),e.type=="LOGOUT"&&(a.user=null)})},beforeDestroy(){this.unsubscribe()},computed:{userId(){return this.$route.name==="MainShowcase"?(this.user||{}).username:this.$route.params.username},editEnabled(){return this.user&&this.user.username&&(this.$route.name==="MainShowcase"||this.$route.params.username===this.user.username||this.user.username==="TiagoXavi")},hasVideo(){return!!this.cars.find(a=>a.video||a.videoUrl)},readyToSave(){return!this.editEnabled||(console.log(0),this.saved)?!1:(console.log(1),this.cars.some(a=>a.video&&a.rid)?!0:(console.log(2),!(!this.tempString||(console.log(3),this.tempString===this.generateTempString(this.cars)))))},isFull(){return this.cars.every(a=>a.videoUrl)}},methods:{getLastest(){this.lastestLoading=!0,axios.get(Vue.preUrl+"/lastest").then(a=>{this.lastestLoading=!1;let e=a.data.find(t=>t.id==="newCars").value;if(e&&e.length>0){let t=this.all_cars.map(s=>s.rid);e.map(s=>{s.photoId&&s.rq&&s.onlyName&&s.brand&&s.country&&s.year&&s.clearance&&s.topSpeed&&s.hand&&s.drive&&s.tyres&&s.weight&&s.tags&&s.bodyTypes&&s.fuel&&s.seats&&s.engine&&(t.includes(s.rid)||this.all_cars.push(s))}),this.all_cars.sort((s,i)=>i.rq-s.rq)}this.load()}).catch(a=>{this.lastestLoading=!1,console.log(a)})},resetCars(){this.cars=[{rid:null,video:null,videoUrl:null,fileToUpload:null,fHeight:!1,showBox:!0},{rid:null,video:null,videoUrl:null,fileToUpload:null,fHeight:!1,showBox:!0},{rid:null,video:null,videoUrl:null,fileToUpload:null,fHeight:!1,showBox:!0}],this.tempString=this.generateTempString(this.cars)},addMoreCar(){this.cars.push({rid:null,video:null,videoUrl:null,fileToUpload:null,fHeight:!1,showBox:!0})},reload(){setTimeout(()=>{this.load()},10)},load(){this.userId&&(this.resetCars(),this.loading=!0,axios.get(Vue.preUrlCharlie+`/showcase/${this.userId}`).then(a=>{this.loading=!1,this.saved=!1,a.data&&a.data.cars&&(this.cars=a.data.cars,this.cars.map(e=>{e.rid&&this.addToResolvedRids(e.rid),e.videoUrl&&(e.videoUrl=e.videoUrl.replace("http://","https://"))})),this.tempString=this.generateTempString(this.cars)}).catch(a=>{this.loading=!1,console.log(a),this.$store.commit("DEFINE_SNACK",{active:!0,error:!0,text:a,type:"error"})}))},save(){this.loading=!0;let a={cars:this.cars,username:this.userId},e=[];this.cars.map(t=>{t.fileToUpload&&e.push({rid:t.rid,fileToUpload:t.fileToUpload})}),a.links=e,axios.post(Vue.preUrl+"/updateShowcase",a).then(t=>{this.loading=!1,this.$store.commit("DEFINE_SNACK",{active:!0,correct:!0,text:this.$t("m_saveSuccess")}),this.saved=!0,this.tempString=this.generateTempString(this.cars),this.updateBackendShowcase()}).catch(t=>{this.loading=!1,console.log(t),this.$store.commit("DEFINE_SNACK",{active:!0,error:!0,text:t,type:"error"})})},loadList(){this.listLoading=!0,axios.get(Vue.preUrlCharlie+"/showcaseList").then(a=>{this.listLoading=!1,this.showcaseList=a.data}).catch(a=>{this.listLoading=!1,console.log(a),this.$store.commit("DEFINE_SNACK",{active:!0,error:!0,text:a,type:"error"})})},updateBackendShowcase(){this.loading=!0,axios.get(Vue.preUrlCharlie+"/updateBackendShowcase").then(a=>{this.loading=!1,this.loadList(),this.load()}).catch(a=>{this.loading=!1,console.log(a),this.$store.commit("DEFINE_SNACK",{active:!0,error:!0,text:a,type:"error"})})},prepareAddCarDialog(a){this.carAddIndex=a,this.searchCarDialog=!0},addCarNew(a){this.cars[this.carAddIndex].rid=a.rid,this.addToResolvedRids(a.rid),this.searchCarDialog=!1},addToResolvedRids(a){if(!this.resolvedRids[a]){let e=this.all_cars.find(t=>t.rid===a);e&&(e=JSON.parse(JSON.stringify(e)),e.color=Vue.resolveClass(e.rq,e.class,"color"),e.colorRgb=Vue.resolveClass(e.rq,e.class,"color",!0),e.photo=Vue.carPhoto(e),this.resolvedRids[a]=e)}},onCloseSearchCarDialog(){},addVideo(a){this.carAddIndex=a,this.uploadInput=document.createElement("input"),this.uploadInput.setAttribute("type","file"),this.uploadInput.setAttribute("accept","video/*"),this.uploadInput.addEventListener("change",this.renderVideo,!1),this.uploadInput.click()},renderVideo(a){var e=a.target.files[0];if(Vue.set(this.cars[this.carAddIndex],"video",URL.createObjectURL(e)),e.size>3*1e3*1e3){this.$store.commit("DEFINE_SNACK",{active:!0,error:!0,text:"File larger than 3 MB",type:"error"});return}const t=new FileReader;t.readAsDataURL(e),t.onload=s=>{Vue.set(this.cars[this.carAddIndex],"fileToUpload",s.target.result)}},removeVideo(a){this.cars[a].video=null,this.cars[a].videoUrl=null,this.cars[a].fileToUpload=null},async downloadImage(a){this.downloadAnchor=document.createElement("a"),await fetch(this.resolvedRids[a].photo).then(e=>e.blob()).then(e=>{let t=URL.createObjectURL(e);this.downloadAnchor.setAttribute("download",`${a}.jpg`),this.downloadAnchor.href=t,this.downloadAnchor.click()})},removeCar(a){this.cars[a].rid=null,this.cars[a].video=null,a>2&&this.cars.splice(a,1)},generateTempString(a){let e=a.map(t=>({videoUrl:t.videoUrl,fileToUpload:t.fileToUpload,fHeight:t.fHeight,showBox:t.showBox}));return e=e.filter((t,s)=>s<3||t.rid&&t.fileToUpload),JSON.stringify(e)},moveLeft(a){if(a===0)return;const e=this.cars[a];this.cars.splice(a,1),this.cars.splice(a-1,0,e)}}};var v=function(){var e=this,t=e._self._c;return t("div",{staticClass:"MainShowcase_Root"},[t("div",{staticClass:"MainShowcase_Header"},[t("div",{staticClass:"MainShowcase_List"},e._l(e.showcaseList,function(s){return t("button",{staticClass:"D_Button D_ButtonDark MainShowcase_UserButton",class:`MainShowcase_Stars_${s.score}`,attrs:{disabled:s.username===e.userId||e.loading||e.readyToSave||e.listLoading},on:{click:function(i){e.$router.replace({name:"MainShowcaseUser",params:{username:s.username}}),e.reload()}}},[t("span",{class:`Main_UserT${e.Vue.utils.highlightsUsers[s.username]}`},[e._v(e._s(s.username))])])}),0)]),t("div",{staticClass:"MainShowcase_PlayControls D_Center"},[e.hasVideo?t("button",{staticClass:"D_Button MainShowcase_PlayButton",on:{click:function(s){e.showVideo=!e.showVideo}}},[t("i",{staticClass:"D_ButtonIcon23",class:`ticon-${e.showVideo?"pause":"play"}`,attrs:{"aria-hidden":"true"}})]):e._e()]),t("div",{staticClass:"MainShowcase_SaveBar D_Center2"},[e.userId?e.readyToSave?t("button",{staticClass:"D_Button Main_SaveAllButton",class:{D_Button_Loading:e.loading},attrs:{disabled:e.loading},on:{click:function(s){return e.save()}}},[t("span",[e._v(e._s(e.$t("m_save")))])]):t("div",{staticClass:"MainShowcase_TitleBox",class:`Main_UserT${e.Vue.utils.highlightsUsers[e.userId]}`},[t("BaseIconSvg",{attrs:{type:"laurel"}}),t("div",{staticClass:"MainShowcase_Title"},[e._v(e._s(e.userId))]),t("BaseIconSvg",{attrs:{type:"laurel"}})],1):t("button",{staticClass:"D_Button Main_LoginToEdit",on:{click:function(s){return e.$store.commit("OPEN_LOGIN")}}},[e._v(e._s(e.$t("m_login")))])]),t("div",{staticClass:"MainShowcase_Mid"},[t("div",{staticClass:"MainShowcase_Cars"},[e._l(e.cars,function(s,i){return[i<3||e.showMore||e.editEnabled?t("div",{staticClass:"MainShowcase_CarItem",class:{MainShowcase_CarItemNoVideo:!(s.video||s.videoUrl)}},[t("div",{staticClass:"MainShowcase_CardTop"},[s.rid?t("div",{staticClass:"MainShowcase_BaseCardDiv"},[t("BaseCard",{class:{Car_WithVideoHeight:s.fHeight,Car_WithVideoNoBox:!s.showBox},attrs:{car:e.resolvedRids[s.rid],videoSrc:e.showVideo?s.video||s.videoUrl:null,isDialogBox:!0,options:!1}})],1):t("div",{staticClass:"MainShowcase_CarPlaceHolder"},[t("button",{staticClass:"D_Button Car_AddButton add MainShowcase_SearchCarButton",attrs:{disabled:e.loading||!e.user||e.userId&&e.user.username!==e.userId},on:{click:function(o){return e.prepareAddCarDialog(i)}}},[t("div",{staticClass:"MainShowcase_SearchCarButtonBox"},[t("i",{staticClass:"ticon-plus_2 Car_AddIcon",attrs:{"aria-hidden":"true"}}),t("div",{staticClass:"MainShowcase_SearchCarLabel"},[e._v(e._s(e.$t("m_searchCar")))])]),t("i",{staticClass:"ticon-car MainShowcase_CarPlaceholder",attrs:{"aria-hidden":"true"}})])])]),s&&s.rid&&e.editEnabled?t("div",{staticClass:"MainShowcase_CardBottom"},[s.video||s.videoUrl?e._e():t("button",{staticClass:"D_Button D_ButtonDark D_ButtonDark2 MainShowcase_OptionButton D_ButtonGreen",staticStyle:{"margin-bottom":"5px"},on:{click:function(o){return e.addVideo(i)}}},[t("i",{staticClass:"ticon-video D_ButtonIcon",attrs:{"aria-hidden":"true"}}),t("span",[e._v(e._s(e.$t("m_addVideo")))])]),t("div",{staticClass:"Main_FilterChipsFlex"},[i!==0&&(s.video||s.videoUrl)&&e.showVideo?t("button",{staticClass:"BaseChip BaseChip_MinWidth BaseChip_DontCrop BaseChip_Icon2",on:{click:function(o){return e.moveLeft(i)}}},[t("i",{staticClass:"ticon-arrow_left_3 D_ButtonIcon24",attrs:{"aria-hidden":"true"}})]):e._e(),(s.video||s.videoUrl)&&e.showVideo?t("BaseChip",{staticClass:"BaseChip_MinWidth BaseChip_DontCrop BaseChip_Icon2",attrs:{inputValue:s.fHeight,value:!0,oneOnly:!0},on:{click:function(o){s.fHeight=!s.fHeight}}},[t("i",{staticClass:"ticon-up_down_1 D_ButtonIcon24",attrs:{"aria-hidden":"true"}})]):e._e(),(s.video||s.videoUrl)&&e.showVideo?t("BaseChip",{staticClass:"BaseChip_MinWidth BaseChip_DontCrop BaseChip_Icon2",attrs:{inputValue:s.showBox,value:!0,oneOnly:!0},on:{click:function(o){s.showBox=!s.showBox}}},[t("i",{staticClass:"ticon-dash D_ButtonIcon24",attrs:{"aria-hidden":"true"}})]):e._e()],1),s.video||s.videoUrl?t("button",{staticClass:"D_Button MainShowcase_OptionButton",on:{click:function(o){return e.removeVideo(i)}}},[t("i",{staticClass:"ticon-close_3 D_ButtonIcon",attrs:{"aria-hidden":"true"}}),t("span",[e._v(e._s(e.$t("m_removeVideo")))])]):e._e(),s.video||s.videoUrl?e._e():t("button",{staticClass:"D_Button MainShowcase_OptionButton",on:{click:function(o){return e.downloadImage(s.rid)}}},[t("i",{staticClass:"ticon-download D_ButtonIcon",attrs:{"aria-hidden":"true"}}),t("span",[e._v(e._s(e.$t("m_downloadImage")))])]),s.video||s.videoUrl?e._e():t("button",{staticClass:"D_Button MainShowcase_OptionButton",on:{click:function(o){return e.removeCar(i)}}},[t("i",{staticClass:"ticon-close_3 D_ButtonIcon",attrs:{"aria-hidden":"true"}}),t("span",[e._v(e._s(e.$t("m_removeCar")))])])]):e._e()]):e._e()]})],2),!e.editEnabled&&!e.showMore&&e.cars.length>3?t("div",{staticClass:"MainShowcase_ D_Center2"},[t("button",{staticClass:"D_Button Main_OptionsButton",staticStyle:{"margin-top":"25px"},on:{click:function(s){e.showMore=!0}}},[t("span",[e._v(e._s(e.$t("m_showMore"))+" ("+e._s(e.cars.length-3)+")")])])]):e._e()]),e.editEnabled?t("div",{staticClass:"MainShowcase_Help"},[t("div",{staticClass:"MainShowcase_ D_Center2"},[e.isFull?t("button",{staticClass:"D_Button Main_OptionsButton",on:{click:function(s){return e.addMoreCar()}}},[t("i",{staticClass:"ticon-plus_2 D_ButtonIcon",staticStyle:{"font-size":"16px"},attrs:{"aria-hidden":"true"}}),t("span",[e._v(e._s(e.$tc("m_car",1)))])]):e._e()]),t("div",{staticClass:"MainShowcase_HelpInner D_Center2"},[t("span",[e._v(e._s(e.$t("m_needHelp")))]),t("a",{staticClass:"D_Button Main_OptionsButton",attrs:{target:"_blank",rel:"noopener noreferrer",href:"https://discord.com/channels/1008569974094311544/1008976247210135603/1299543503482785792"}},[t("BaseIconSvg",{staticStyle:{width:"25px",margin:"-5px 6px -5px 0"},attrs:{type:"discord",useMargin:!1}}),t("span",[e._v(e._s(e.$t("m_instructions")))])],1)])]):e._e(),t("BaseFilterDialog",{attrs:{sortEnabled:!0,enableCounters:!1,forceNonPrize:!1},on:{addCar:function(s){return e.addCarNew(s)},close:function(s){return e.onCloseSearchCarDialog()}},model:{value:e.searchCarDialog,callback:function(s){e.searchCarDialog=s},expression:"searchCarDialog"}}),t("BaseDialog",{attrs:{active:e.confirmDelete.dialog,transparent:!1,lazy:!0,zindex:"101","max-width":"420px","min-width":"240px"},on:{close:function(s){e.confirmDelete.dialog=!1}}},[t("div",{staticStyle:{}},[t("div",{staticClass:"Main_DialogMessage"},[e._v(e._s(e.confirmDelete.msg))]),t("div",{staticClass:"Main_DialogBottom"},[t("button",{staticClass:"D_Button Main_OptionsButton",on:{click:function(s){e.confirmDelete.dialog=!1}}},[t("span",[e._v(e._s(e.$t("m_cancel")))])]),t("button",{staticClass:"D_Button Main_OptionsButton",class:`${e.loading?"D_Button_Loading ":""}${e.confirmDelete.classe}`,attrs:{disabled:e.loading},on:{click:e.confirmDelete.action}},[t("span",[e._v(e._s(e.confirmDelete.actionLabel))])])])])])],1)},f=[],C=r(p,v,f,!1,null,null);const B=C.exports;export{B as default};
