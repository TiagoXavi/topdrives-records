import{a as c}from"./index-C8gjSc4W.js";import{n as C,k as v,T as f,y as _,p as m,a as p,o as M}from"./components-DpxtCXPw.js";const b={name:"MainCsvChart",components:{BaseCardGallery:M,BaseFilterDialog:p,BaseFilterDescription:m,BaseIconSvg:_,HighchartsGeneric:f,BaseChip:v},props:{test:{type:Boolean,default:!1}},data(){return{items:[],all_cars:c,all_cars_obj:{},resolvedRids:{},guidToRid:{},carsReady:!1,memoryFileName:"Rallycross medium_30Dirt&70Mud.csv",chartHideOutOfFilter:!1,tyres:["Off-road","All-surface","Standard","Performance","Slick"],drives:["FWD","RWD","4WD"],clearances:["Low","Mid","High"],tyresModel:[],drivesModel:[],clearancesModel:[],hoverClass:"",cats:["2WD_Off-road","2WD_All-surface","2WD_Standard","2WD_Performance","Slick","4WD_Off-road","4WD_All-surface","4WD_Standard","4WD_Performance"]}},watch:{},beforeMount(){this.tyresModel=this.tyres,this.drivesModel=this.drives,this.clearancesModel=this.clearances},mounted(){this.carsReady||this.transformAllCarsToObj(),typeof temp<"u"&&this.pushNewItem(temp)},computed:{},methods:{pushNewItem(a){a[0].Time&&a.map(s=>{if(s.time=Number(s.Time),s.timeParsed=s.time.toHHMMSS(),s.rid=this.guidToRid[s["Car GUID"]],s.rq=Number(s.RQ),s.class=Vue.resolveClass(s.rq,null,"letter"),!s.rid)debugger;this.addToResolvedRids(s.rid),s.car=this.all_cars_obj[s.rid];let o="";s.car.tyres==="Slick"?o="Slick":(s.car.drive==="4WD"?o="4WD":o="2WD",o+=`_${s.car.tyres}`),s.cat=o});let e={json:a,title:this.memoryFileName,filter:{},charts:[this.chart_scatter(a),this.chart_line(a)]};this.items.push(e)},loadCSV(a,e=null){if(!e&&(!a.target.files||a.target.files.length===0))return;e||(e=a.target.files[0]),this.memoryFileName=e.name;let s=new FileReader;s.onload=this.onload,s.readAsText(e)},onload(a){let e=a.target.result,s=this.csvJSON(e);this.pushNewItem(s)},csvJSON(a){var e=a.split(`
`),s=[],o=e[0].split(",");let l=["09d252e4-0027-403a-98ac-8d9c221553ba","40c22d49-b033-4e08-931b-1cdf974b8a42","951ddd6a-dbec-4332-b870-abade85f2654","17266626-c38c-4b1d-8bb9-630df210349c","7e3cd48b-109b-4d48-a163-959a732657de","4a71feed-db9e-420d-96f1-6d174a1f32cd","d91a3551-0098-4b63-805a-35ede20ade3c","25db2bc3-dcbe-41a6-8466-38a52d1485d6","00c58c19-0efa-4158-b45b-77a16ca9647f","238d59c6-71fc-469a-8add-487754de7e74"];for(var i=1;i<e.length;i++){for(var t={},r=e[i].split(","),n=0;n<o.length;n++)t[(o[n]||"").trim()]=(r[n]||"").trim();t["Car GUID"]&&(l.includes(t["Car GUID"])||s.push(t))}return s},addToResolvedRids(a){if(!this.resolvedRids[a]){let e=this.all_cars_obj[a];e&&(e.color=Vue.resolveClass(e.rq,e.class,"color"),e.colorRgb=Vue.resolveClass(e.rq,e.class,"color",!0),e.photo=Vue.carPhoto(e),this.resolvedRids[a]=e)}},transformAllCarsToObj(){let a="rid";c.map(e=>{this.all_cars_obj[e[a]]=e,this.guidToRid[e.guid]=e.rid}),this.carsReady=!0},detailClick(a){console.log(JSON.parse(JSON.stringify(a.point.custom)))},chart_scatter(a){let e=[];a.map((l,i)=>{if(this.chartHideOutOfFilter||l.Result!=="Finished")return;let t=e.find(r=>r.name===l.class);t||(e.push({name:l.class,color:Vue.resolveClass(l.rq,l.class,"color")}),t=e[e.length-1]),t.data||(t.data=[]),t.data.push({y:l.rq,x:l.time,name:`${l.Name}`,className:`MainCsvChart_C_DRIVE_${l.car.drive} MainCsvChart_C_TYRE_${l.car.tyres} MainCsvChart_C_CLEAR_${l.car.clearance}`,custom:{...l,photo:this.resolvedRids[l.rid].photo,color:this.resolvedRids[l.rid].color}})});var s="ontouchstart"in window||navigator.msMaxTouchPoints;return{config:{boost:{seriesThreshold:e.length,useGPUTranslations:!0,usePreAllocated:!0},chart:{type:"scatter",height:600},legend:{enabled:!1},series:e,yAxis:{min:10,max:120,allowDecimals:!1,labels:{format:"RQ{text}"}},xAxis:{type:"logarithmic",allowDecimals:!1,labels:{format:"{text}s"}},tooltip:{snap:s?50:10},plotOptions:{series:{stickyTracking:!!s,turboThreshold:2e3},scatter:{boostThreshold:2e3}}},counter:0}},chart_line(a){let e=[],s={},o={};this.cats.map(t=>{s[t]={},o[t]={},e.push({name:t,data:[]})}),a.map((t,r)=>{t.Result==="Finished"&&(s[t.cat][t.rq]||(s[t.cat][t.rq]=[]),s[t.cat][t.rq].push(t.time))}),Object.keys(s).map(t=>{Object.keys(s[t]).map(r=>{let d=s[t][r].reduce((h,u)=>h+u,0)/s[t][r].length;if(isNaN(d)||d<0)debugger;o[t][r]=d})}),e.map(t=>{Object.keys(o[t.name]).map(r=>{t.data.push({y:Number(r),x:Number(o[t.name][r].toFixed(2))}),t.data.sort((n,d)=>n.y-d.y)}),t.dataLabels={enabled:!0,formatter:function(){return this.point.index===this.series.data.length-1?this.series.name:""},style:{fontWeight:"bold",color:"black"}}});var l="ontouchstart"in window||navigator.msMaxTouchPoints;return{config:{disableTooltipFormater:!1,title:{text:"Avg time per RQ and cat"},boost:{seriesThreshold:e.length,useGPUTranslations:!0,usePreAllocated:!0},chart:{type:"spline",height:600},colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],legend:{enabled:!0},series:e,yAxis:{min:10,max:120,allowDecimals:!1,labels:{format:"RQ{text}"}},xAxis:{type:"logarithmic",allowDecimals:!1,labels:{format:"{text}s"}},tooltip:{snap:l?50:10},plotOptions:{series:{stickyTracking:!!l,turboThreshold:2e3}}},counter:0}}}};var g=function(){var e=this,s=e._self._c;return s("div",{staticClass:"MainCsvChart_Layout"},[e._l(e.items,function(o,l){return s("div",{staticClass:"MainCsvChart_W"},[s("div",{staticClass:"MainCsvChart_Header"},[s("div",{staticClass:"MainCsvChart_"}),s("div",{staticClass:"MainCsvChart_ItemTitle"},[e._v(e._s(o.title))]),s("div",{staticClass:"MainCsvChart_HeaderDelete"},[s("button",{staticClass:"D_Button D_ButtonDarkTransparent",on:{click:function(i){e.items=e.items.filter((t,r)=>r!==l)}}},[s("i",{staticClass:"ticon-close_3",attrs:{"aria-hidden":"true"}})])])]),s("div",{staticClass:"MainCsvChart_Body",class:{MainCsvChart_Not_FWD:!e.drivesModel.includes("FWD")||e.hoverClass==="FWD",MainCsvChart_Not_RWD:!e.drivesModel.includes("RWD")||e.hoverClass==="RWD",MainCsvChart_Not_4WD:!e.drivesModel.includes("4WD")||e.hoverClass==="4WD",MainCsvChart_Not_Low:!e.clearancesModel.includes("Low")||e.hoverClass==="Low",MainCsvChart_Not_Mid:!e.clearancesModel.includes("Mid")||e.hoverClass==="Mid",MainCsvChart_Not_High:!e.clearancesModel.includes("High")||e.hoverClass==="High",MainCsvChart_Not_Performance:!e.tyresModel.includes("Performance")||e.hoverClass==="Performance",MainCsvChart_Not_Standard:!e.tyresModel.includes("Standard")||e.hoverClass==="Standard","MainCsvChart_Not_All-surface":!e.tyresModel.includes("All-surface")||e.hoverClass==="All-surface","MainCsvChart_Not_Off-road":!e.tyresModel.includes("Off-road")||e.hoverClass==="Off-road",MainCsvChart_Not_Slick:!e.tyresModel.includes("Slick")||e.hoverClass==="Slick"}},[s("div",{staticClass:"MainCsvChart_Chips"},[s("div",{staticClass:"Main_FilterThree",staticStyle:{margin:"15px 0px"}},[s("div",{staticClass:"Main_FilterChipsInside"},[e._l(e.tyres,function(i,t){return[s("div",{on:{mouseover:function(r){e.hoverClass=i},mouseout:function(r){e.hoverClass=""}}},[s("BaseChip",{staticClass:"BaseChip_MinWidth",attrs:{label:e.$t(`c_${i.toLowerCase()}2`),value:i},model:{value:e.tyresModel,callback:function(r){e.tyresModel=r},expression:"tyresModel"}})],1)]})],2),s("div",{staticClass:"Main_FilterChipsInside"},[e._l(e.drives,function(i,t){return[s("div",{on:{mouseover:function(r){e.hoverClass=i},mouseout:function(r){e.hoverClass=""}}},[s("BaseChip",{staticClass:"BaseChip_MinWidth",attrs:{value:i},model:{value:e.drivesModel,callback:function(r){e.drivesModel=r},expression:"drivesModel"}})],1)]})],2),s("div",{staticClass:"Main_FilterChipsInside"},[e._l(e.clearances,function(i,t){return[s("div",{on:{mouseover:function(r){e.hoverClass=i},mouseout:function(r){e.hoverClass=""}}},[s("BaseChip",{staticClass:"BaseChip_MinWidth",attrs:{label:e.$t(`c_${i.toLowerCase()}`),value:i},model:{value:e.clearancesModel,callback:function(r){e.clearancesModel=r},expression:"clearancesModel"}})],1)]})],2)])]),e._l(o.charts,function(i){return s("div",{staticClass:"MainCsvChart_Chart"},[i.config?s("div",{staticClass:"MainCharts_Body"},[s("HighchartsGeneric",{attrs:{config:i.config,counter:i.counter,trackCode:i.trackCode||""},on:{detail:function(t){return e.detailClick(t)}}})],1):e._e()])})],2)])}),s("div",{staticClass:"MainCsvChart_Footer D_Center2"},[s("div",{staticClass:"MainCsvChart_UploadButton"},[s("label",{staticClass:"D_Button D_ButtonDark D_ButtonDark2 MainCsvChart_UploadButton"},[s("input",{staticClass:"MainCsvChart_UploadInput",attrs:{type:"file",accept:"text/csv"},on:{change:function(o){return e.loadCSV(o)}}}),s("span",{staticClass:"MainCsvChart_UploadLabel"},[e._v("Load raw (CSV)")])])])])],2)},y=[],D=C(b,g,y,!1,null,null);const T=D.exports;export{T as default};
