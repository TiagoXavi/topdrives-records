import{B as l}from"./BaseSearchTrackDialog-CBBcnIL0.js";import{B as u}from"./BaseCardGallery-D4R06ceq.js";import{B as d}from"./BaseCard-CTEQO1B5.js";import{n as m,h as f,b as T,e as h,m as k,t as g,k as p}from"./index-BR-PFC2m.js";import{R as _}from"./Row-DOgu6NRG.js";import{c as C}from"./campaign-Dapxa4yk.js";import"./Car-CQ6DFsNz.js";const v={name:"MainTestPoints",components:{BaseCardGallery:u,BaseConfigCheckBox:h,Row:_,BaseCard:d,BaseDialog:T,BaseSearchTrackDialog:l,BaseText:f},props:{test:{type:Boolean,default:!1}},data(){return{loading:!1,ridLoading:null,downTimes:{},all_cars:p,all_cars_obj:{},showBigCards:!0,chartTrack:!1,customTrackDialog:!1,tracksRepo:g,campaign:C,tracks_factor:k,user:null,unsubscribe:null,voteLoading:!1,confirmDelete:{dialog:!1,msg:"Confirm delete?",actionLabel:"Delete",action:null,loading:!1,classe:""},showCarsFix:!0,fakeCar1:{rid:"fake1",selectedTune:"Other"},fakeCustomData1:{},fakeTime1:void 0,fakeCar2:{rid:"fake2",selectedTune:"Other"},fakeCustomData2:{},fakeTime2:void 0,informCorrectPoints:null,showCarsFix:!0,campaignList:[]}},watch:{chartTrack(){this.changedTrack()}},beforeMount(){},mounted(){this.user={username:"fake",mod:!0}},beforeDestroy(){},computed:{currentTrackFactor(){if(this.chartTrack)return this.tracks_factor[this.chartTrack.id]},fixedTrackFactor(){if(!this.chartTrack||!this.informCorrectPoints||!this.fakeTime1||!this.fakeTime2)return;let a=Math.min(this.fakeTime1,this.fakeTime2),e=Math.max(this.fakeTime1,this.fakeTime2),s=this.informCorrectPoints/(-a/e+1);return Math.round(s)},pointsResult(){if(this.chartTrack&&this.fakeTime1&&this.fakeTime2)return Vue.options.filters.userPoints(this.fakeTime1,this.fakeTime2,this.chartTrack.code)}},methods:{changedTrack(){delete this.fakeCar1.data,delete this.fakeCar2.data,this.fakeTime1=void 0,this.fakeTime2=void 0,this.informCorrectPoints=null,this.showCarsFix=!1,this.$nextTick().then(()=>{this.showCarsFix=!0,this.$nextTick().then(()=>{document.querySelector("div.MainTestPoints_Header > div:nth-child(2) div.Row_Content").focus()})}),this.listOptions()},openDialogTrackSearch(){this.customTrackDialog=!0,setTimeout(()=>{try{document.querySelector("#SearchTrackInput").focus()}catch{}},10)},closeDialogTrackSearch(){this.customTrackDialog=!1,this.searchTracks=""},toggleTrack(a,e={}){this.closeDialogTrackSearch()},getResolvedTrack(a){this.chartTrack=a},listOptions(){let a=[];this.campaign.map((e,t)=>{e.matches.map((s,i)=>{s.races.map((r,o)=>{r.name===this.chartTrack.code&&a.push(`${e.name} ${i+1} r${o+1}`)})})}),this.campaignList=a},validateTracks(a,e=!1){let t=[],s,i,r=[];if(a.map(o=>{this.tracksRepo.find(n=>{if(o.slice(0,-4)!==n.id)return!1;n.types.find(c=>{if(o===`${n.id}_a${c}`)return e&&n.group?(s=n.group,i=c):t.push({name:n.name,id:n.id,surface:c[0],cond:c[1],code:`${n.id}_a${c}`}),!0})})}),e)this.tracksRepo.map(o=>{s===o.group&&o.types.includes(i)&&r.push(`${o.id}_a${i}`)}),this.toggleTrackSet(r);else return t},isChamp(a){return a.startsWith("SN")||a.startsWith("YB")},changeTime(a,e){let t=this,s=a.selectedTune,i=this.chartTrack.code,r=e.number;a.data||Vue.set(a,"data",{}),a.data[s]||Vue.set(a.data,s,{}),a.data[s].times||Vue.set(a.data[s],"times",{}),a.data[s].times[i]||Vue.set(a.data[s].times,i,{}),a.dataToSave||Vue.set(a,"dataToSave",{}),a.dataToSave[s]||Vue.set(a.dataToSave,s,{}),a.dataToSave[s].times||Vue.set(a.dataToSave[s],"times",{}),a.dataToSave[s].times[i]||Vue.set(a.dataToSave[s].times,i,{}),Vue.set(a.data[s].times[i],"t",r),Vue.set(a.data[s].times[i],"u",t.user.username),Vue.set(a.data[s].times[i],"down",[]),Vue.set(a.data[s].times[i],"up",[]),Vue.set(a.dataToSave[s].times[i],"t",r),a.rid==="fake1"&&(this.fakeTime1=r),a.rid==="fake2"&&(this.fakeTime2=r)},deleteTime(a,e){let t=this,s=function(){t.confirmDelete.loading=!0,t.ridLoading=a.rid,axios.post(Vue.preUrl+"/deleteTime",{rid:a.rid,tune:a.selectedTune,track:a.track}).then(i=>{t.confirmDelete.dialog=!1,t.getDownTimes(),t.$store.commit("DEFINE_SNACK",{active:!0,correct:!0,text:t.$t("m_deleteSuccess")})}).catch(i=>{console.log(i)}).then(()=>{t.confirmDelete.loading=!1,t.ridLoading=null})};this.confirmDelete={dialog:!0,msg:`Delete '${a.track}' time of ${a.rid}?`,actionLabel:"Delete",action:s,loading:!1,classe:"D_ButtonRed"}},saveRid(a){this.ridLoading=a;let e=[];this.downTimes[a].map(t=>{t.car.dataToSave&&e.push({rid:a,data:t.car.dataToSave})}),axios.post(Vue.preUrl+"/update",e).then(t=>{this.getDownTimes()}).catch(t=>{console.log(t)}).then(()=>{this.ridLoading=null})},outsideClick(){this.$store.commit("HIDE_DETAIL")}}};var D=function(){var e=this,t=e._self._c;return t("div",{staticClass:"MainTestPoints_Layout"},[t("div",{staticClass:"MainTestPoints_BlockBack",on:{click:function(s){return s.stopPropagation(),e.outsideClick()}}}),e.showCarsFix?t("div",{staticClass:"MainTestPoints_Header"},[t("div",{staticClass:"Cg_Track"},[e.chartTrack?t("Row",{staticClass:"Cg_TrackBox",attrs:{list:[e.chartTrack],loggedin:!!e.user,user:e.user,options:!0,cg:!0,normalSize:!0,type:"tracks"}}):e._e(),t("button",{staticClass:"D_Button Car_AddButton Cg_SelectTrackButton",class:{Cg_SelectTrackButtonEdit:e.chartTrack},on:{click:function(s){return e.openDialogTrackSearch()}}},[e.chartTrack?t("i",{staticClass:"ticon-pencil Cg_SelectTrackButtonIcon",attrs:{"aria-hidden":"true"}}):t("span",[e._v(e._s(e.$t("m_selectTrack")))])])],1),t("div",{staticClass:"MainTestPoints_Time"},[t("div",{staticClass:"MainTestPoints_TimeLeft"},[e._v("Your time: ")]),t("Row",{attrs:{car:e.fakeCar1,list:[e.chartTrack],loggedin:!!e.user,user:e.user,voteLoading:e.voteLoading,cg:!0,cgOppo:!0,cgTime:e.fakeTime1,forceDisabled:!e.user||!e.user.mod||!e.chartTrack,forceCustomAuthor:!0,customData:e.fakeCustomData1,placeholder:"Time 1",type:"times"},on:{deleteTime:function(s){return e.deleteTime(e.fakeCar1,s)},changeTime:function(s){return e.changeTime(e.fakeCar1,s)}}})],1),t("div",{staticClass:"MainTestPoints_Time"},[t("div",{staticClass:"MainTestPoints_TimeLeft"},[e._v("Oppo time: ")]),t("Row",{attrs:{car:e.fakeCar2,list:[e.chartTrack],loggedin:!!e.user,user:e.user,voteLoading:e.voteLoading,cg:!0,cgOppo:!0,cgTime:e.fakeTime2,forceDisabled:!e.user||!e.user.mod||!e.chartTrack,forceCustomAuthor:!0,customData:e.fakeCustomData2,placeholder:"Time 2",type:"times"},on:{deleteTime:function(s){return e.deleteTime(e.fakeCar2,s)},changeTime:function(s){return e.changeTime(e.fakeCar2,s)}}})],1),e.pointsResult?t("div",{staticClass:"MainTestPoints_Result"},[t("div",{staticClass:"MainTestPoints_ResultTdr"},[t("div",{staticClass:"BaseText_Label"},[e._v("Points:")]),t("div",{staticClass:"MainTestPoints_ResultTdrPoints",class:{MainTestPoints_ResultTdrPointsLose:e.pointsResult.v<0}},[e._v(e._s(e.pointsResult.i?"~":"")+e._s(e.pointsResult.v))])]),t("div",{staticClass:"MainTestPoints_ResultByUser"},[t("BaseText",{staticClass:"BaseText_Big",attrs:{iid:"correctPoints",label:"Incorrect points?",type:"integer",placeholder:""},model:{value:e.informCorrectPoints,callback:function(s){e.informCorrectPoints=s},expression:"informCorrectPoints"}})],1)]):e._e(),e.pointsResult?t("div",{staticClass:"MainTestPoints_FactorsBox",staticStyle:{"margin-top":"30px"}},[t("div",{staticClass:"MainTestPoints_Factor"},[e._v("'"+e._s(e.$t(`t_${e.chartTrack.id}`))+"' factor: "),t("b",[e._v(e._s(e.currentTrackFactor))])])]):e._e(),e.pointsResult&&e.informCorrectPoints&&!isNaN(e.informCorrectPoints)?t("div",{staticClass:"MainTestPoints_FactorsBox"},[t("div",{staticClass:"MainTestPoints_Factor"},[e._v("New track factor: "),t("b",[e._v("~"+e._s(e.fixedTrackFactor))])])]):e._e(),e.campaignList.length>0?t("div",{staticClass:"MainTestPoints_FactorsBox"},e._l(e.campaignList,function(s){return t("div",{staticClass:"MainTestPoints_Factor"},[e._v(e._s(s))])}),0):e._e()]):e._e(),t("BaseSearchTrackDialog",{attrs:{active:e.customTrackDialog},on:{close:function(s){return e.closeDialogTrackSearch()},toggleTrack:function(s){return e.toggleTrack(s.track,s.e)},resolved:function(s){return e.getResolvedTrack(s)}}})],1)},P=[],B=m(v,D,P,!1,null,null);const b=B.exports;export{b as default};
